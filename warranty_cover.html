<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>JINDE | 保固書封面生產</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        body { background-color: #0f172a; font-family: 'Noto Sans TC', sans-serif; display: flex; overflow: hidden; }
        @page { size: A4; margin: 0; }
        
        .admin-panel {
            width: 360px; height: 100vh;
            background: rgba(30, 41, 59, 1);
            padding: 30px; z-index: 1000; border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto; flex-shrink: 0;
        }

        .preview-area { flex-grow: 1; height: 100vh; overflow-y: auto; padding: 40px; display: flex; justify-content: center; }

        .a4-page {
            width: 210mm; height: 297mm;
            background: white; position: relative; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); flex-shrink: 0;
        }

        .cover-logo { width: 140mm; object-fit: contain; margin-bottom: 20mm; }
        .cover-title { font-size: 28pt; font-weight: 900; letter-spacing: 0.2em; margin-bottom: 50mm; color: #333; text-align: center; padding: 0 20mm; }
        .cover-footer { position: absolute; bottom: 30mm; text-align: center; color: #666; width: 100%; }

        .back-home {
            display: flex; align-items: center; gap: 8px; color: #94a3b8;
            font-size: 0.875rem; font-weight: 600; margin-bottom: 2rem;
            transition: 0.3s; cursor: pointer; text-decoration: none;
        }
        .back-home:hover { color: #2dd4bf; transform: translateX(-4px); }

        @media print {
            body { background: none; }
            .no-print { display: none !important; }
            .preview-area { padding: 0; overflow: visible; display: block; }
            .a4-page { margin: 0 auto; box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="no-print admin-panel text-white">
        <a href="warranty.html" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Back / 返回保固中控
        </a>

        <h2 class="text-2xl font-black mb-6 text-teal-400">封面生產器</h2>
        
        <div class="space-y-6">
            <div class="bg-slate-800 p-4 rounded-xl border border-teal-900/50">
                <label class="block text-[10px] font-bold text-teal-500 mb-2 uppercase tracking-widest">載入案場標題</label>
                <select id="projectSelect" onchange="applyProjectTitle()" class="w-full bg-slate-900 border-none rounded-lg p-3 text-sm focus:ring-1 focus:ring-teal-500 outline-none">
                    <option value="">-- 手動輸入 --</option>
                </select>
            </div>

            <div>
                <label class="block text-xs text-slate-400 mb-2 font-bold uppercase tracking-widest">1. 上傳封面 Logo</label>
                <input type="file" class="text-xs file:bg-slate-700 file:text-white file:border-0 file:rounded-md file:px-3 file:py-2 hover:file:bg-teal-600 cursor-pointer" onchange="loadCover(event)">
            </div>
            <div>
                <label class="block text-xs text-slate-400 mb-2 font-bold uppercase tracking-widest">2. 封面標題文字</label>
                <input type="text" id="in_title" value="工程保固證明書" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:border-teal-500 outline-none" oninput="sync()">
            </div>
            <div>
                <label class="block text-xs text-slate-400 mb-2 font-bold uppercase tracking-widest">3. 底部通訊資訊</label>
                <textarea id="in_info" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm h-24 focus:border-teal-500 outline-none" oninput="sync()">地址：台中市北屯區山西路二段 250 號&#10;專業 · 智能 · 細心 · 責任</textarea>
            </div>
            
            <div class="pt-4">
                <button onclick="window.print()" class="w-full bg-teal-500 py-4 rounded-xl font-black text-lg shadow-lg hover:bg-teal-400 active:scale-95 transition-all">
                    列印正式封面
                </button>
            </div>
        </div>
    </div>

    <div class="preview-area">
        <div class="a4-page">
            <h2 id="out_title" class="cover-title">工程保固證明書</h2>
            <img id="cover_img" src="" class="cover-logo" style="display:none;">
            <div id="out_info" class="cover-footer whitespace-pre-line text-sm leading-loose tracking-[0.3em] font-medium">
                地址：台中市北屯區山西路二段 250 號
                專業 · 智能 · 細心 · 責任
            </div>
        </div>
    </div>

    <script>
        // Supabase 初始化 (使用與內頁相同的 Key)
        const S_URL = 'https://wdpxgichzvfebhlukbrl.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndkcHhnaWNoenZmZWJobHVrYnJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMjExMzQsImV4cCI6MjA4NDU5NzEzNH0.--85I0A-7WKt0P-ex1Zdnb8UVspuMNshzQtNaLedKq0';
        const _supabase = supabase.createClient(S_URL, S_KEY);

        let projects = [];

        async function init() {
            const { data } = await _supabase.from('projects').select('*').order('created_at', { ascending: false });
            if (data) {
                projects = data;
                const select = document.getElementById('projectSelect');
                data.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.name;
                    opt.text = p.name;
                    select.add(opt);
                });
            }
        }

        function applyProjectTitle() {
            const val = document.getElementById('projectSelect').value;
            if(val) {
                document.getElementById('in_title').value = val + "\n工程保固證明書";
                sync();
            }
        }

        function loadCover(e) {
            const out = document.getElementById('cover_img');
            if(e.target.files[0]) {
                out.src = URL.createObjectURL(e.target.files[0]);
                out.style.display = 'block';
            }
        }

        function sync() {
            document.getElementById('out_title').innerText = document.getElementById('in_title').value;
            document.getElementById('out_info').innerText = document.getElementById('in_info').value;
        }

        window.onload = init;
    </script>
</body>
</html>
