<script>
        // 1. 使用您目前的 ngrok 網址
        const pb = new PocketBase('https://unoppressed-nonanimate-albertina.ngrok-free.dev');
        
        // 2. 使用 API Preview 顯示的正確名稱 (注意大寫 C)
        // 或是使用 ID 'pbc_1836797931'
        const COLLECTION_ID = 'Contracts';

        async function loadDocs() {
            try {
                // 改為抓取完整清單，這能避開單一 ID 請求失敗的 204 錯誤
                const records = await pb.collection(COLLECTION_ID).getFullList({ 
                    sort: '-created',
                    $autoCancel: false // 防止快速切換導致的取消錯誤
                });
                
                const container = document.getElementById('docContainer');
                container.innerHTML = '';
                document.getElementById('totalDocs').innerText = records.length;
                document.getElementById('syncStatus').innerText = "已連線";

                if (records.length === 0) {
                    container.innerHTML = '<div class="text-center py-10 text-slate-400 text-xs">目前沒有任何檔案。</div>';
                    return;
                }

                records.forEach(doc => {
                    // 自動尋找檔案欄位，對應後台顯示的檔案圖示
                    const fileName = doc.file || "";
                    const fileUrl = fileName ? pb.files.getUrl(doc, fileName) : "#";
                    
                    const itemHtml = `
                        <div class="doc-item p-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <i class="far fa-file-alt text-teal-500 text-2xl"></i>
                                <div>
                                    <h4 class="text-sm font-bold text-slate-800">${doc.name || '未命名文件'}</h4>
                                    <p class="text-[10px] text-slate-400">上傳日期：${new Date(doc.created).toLocaleDateString()} · 類別：${doc.category || '未分類'}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-6">
                                <span class="${doc.status === '已用印' ? 'status-signed' : 'status-pending'} text-[10px] font-black px-3 py-1 rounded-full uppercase">${doc.status || '新檔案'}</span>
                                <div class="flex gap-2">
                                    <a href="${fileUrl}" target="_blank" class="w-8 h-8 rounded-lg bg-slate-50 text-slate-400 hover:text-teal-600 transition flex items-center justify-center">
                                        <i class="fas fa-external-link-alt text-xs"></i>
                                    </a>
                                    <button onclick="deleteDoc('${doc.id}')" class="w-8 h-8 rounded-lg bg-slate-50 text-slate-400 hover:text-rose-600 transition">
                                        <i class="fas fa-trash-alt text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                    container.insertAdjacentHTML('beforeend', itemHtml);
                });
            } catch (error) {
                document.getElementById('syncStatus').innerText = "連線失敗";
                console.error("載入失敗:", error);
            }
        }

        async function uploadNewFile(input) {
            if (!input.files.length) return;
            const file = input.files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('name', file.name);
            formData.append('status', '等待審核');
            formData.append('category', '工程合約');

            try {
                document.getElementById('syncStatus').innerText = "上傳中...";
                await pb.collection(COLLECTION_ID).create(formData);
                input.value = '';
                loadDocs();
            } catch (err) {
                alert("上傳失敗：" + err.message);
                loadDocs();
            }
        }

        async function deleteDoc(id) {
            if (!confirm('確定要永久刪除此文件嗎？')) return;
            try {
                await pb.collection(COLLECTION_ID).delete(id);
                loadDocs();
            } catch (err) {
                alert("刪除失敗");
            }
        }

        // 初始化載入
        loadDocs();
    </script>
