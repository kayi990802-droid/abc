<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JINDE | éŒ¦å¾·å ±åƒ¹ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0f172a; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* éŸ¿æ‡‰å¼ä½ˆå±€è¨­å®š */
        @media (min-width: 1024px) {
            body { flex-direction: row; overflow: hidden; }
            .admin-sidebar { width: 400px; height: 100vh; overflow-y: auto; border-right: 1px solid rgba(255,255,255,0.1); padding: 24px; background: #1e293b; }
            .main-content { flex: 1; height: 100vh; overflow-y: auto; padding: 40px; background: #334155; }
        }

        @media (max-width: 1023px) {
            .admin-sidebar { width: 100%; padding: 20px; background: #1e293b; }
            .main-content { padding: 10px; background: #334155; }
            .a4-preview { transform: scale(0.42); transform-origin: top center; margin-bottom: -160mm; }
        }

        /* A4 ç´™å¼µæ¨£å¼ - åš´æ ¼ä¿ç•™æ‚¨åŸæœ¬çš„è¦–è¦º */
        .a4-preview {
            width: 210mm; min-height: 297mm; background: white; color: #1e293b;
            padding: 20mm; margin: 0 auto; box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        /* ç®¡ç†é¢æ¿è¼¸å…¥æ¡† */
        .admin-input { font-size: 16px !important; color: #fff; background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 10px; width: 100%; margin-bottom: 12px; }
        .label-mini { font-size: 11px; font-weight: 800; color: #94a3b8; margin-bottom: 4px; display: block; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .main-content { padding: 0; background: white; overflow: visible; }
            .a4-preview { transform: scale(1) !important; margin: 0 !important; box-shadow: none; width: 210mm; }
        }

        .photo-card { position: relative; border-radius: 8px; overflow: hidden; height: 180px; background: #f8fafc; border: 1px dashed #cbd5e1; }
        .photo-card img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

    <div class="admin-sidebar no-print space-y-6">
        <h2 class="text-xl font-black text-teal-400 border-b border-slate-700 pb-4">JINDE ç®¡ç†é¢æ¿</h2>
        
        <section>
            <label class="label-mini">å®¢æˆ¶è³‡æ–™</label>
            <input type="text" id="in_name" class="admin-input" placeholder="å®¢æˆ¶å§“å" oninput="sync()">
            <input type="text" id="in_addr" class="admin-input" placeholder="æ–½å·¥åœ°å€" oninput="sync()">
            <input type="text" id="in_phone" class="admin-input" placeholder="è¯çµ¡é›»è©±" oninput="sync()">
        </section>

        <section class="bg-slate-800/80 p-4 rounded-xl">
            <label class="label-mini text-teal-500">é¢ç©è©¦ç®— (å…¬å°º)</label>
            <div class="flex gap-2">
                <input type="number" id="calc_l" placeholder="é•·" class="admin-input mb-0 text-center">
                <input type="number" id="calc_w" placeholder="å¯¬" class="admin-input mb-0 text-center">
                <button onclick="applyArea()" class="bg-teal-600 px-4 rounded-lg font-bold">è¨ˆç®—</button>
            </div>
            <p class="text-right text-xs mt-2 text-slate-400">çµæœï¼š<span id="res_area" class="text-teal-400 font-bold">0</span> åª</p>
        </section>

        <section>
            <label class="label-mini text-slate-400">å¿«é€Ÿå·¥æ³•ç¯„æœ¬</label>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="addFromTemplate('roof')" class="bg-slate-700 hover:bg-slate-600 text-[10px] p-2 rounded-lg border-l-4 border-teal-500 text-left">ğŸ—ï¸ é ‚æ¨“ä¸‰å¡—</button>
                <button onclick="addFromTemplate('bathroom')" class="bg-slate-700 hover:bg-slate-600 text-[10px] p-2 rounded-lg border-l-4 border-blue-500 text-left">ğŸ› æµ´å®¤é˜²æ°´</button>
                <button onclick="addFromTemplate('crack')" class="bg-slate-700 hover:bg-slate-600 text-[10px] p-2 rounded-lg border-l-4 border-rose-500 text-left">ğŸ’‰ é«˜å£“çŒæ³¨</button>
            </div>
        </section>

        <section>
            <label class="label-mini">ä¸Šå‚³ç¾å ´ç…§ç‰‡</label>
            <input type="file" id="photoInput" multiple accept="image/*" class="hidden" onchange="handlePhotos(this)">
            <button onclick="document.getElementById('photoInput').click()" class="w-full bg-slate-700 py-3 rounded-xl text-xs font-bold border border-slate-600"><i class="fas fa-camera mr-2"></i>æ‹ç…§ / ä¸Šå‚³</button>
        </section>

        <button onclick="saveAndPrint()" class="w-full bg-teal-500 hover:bg-teal-400 text-white py-4 rounded-2xl font-black text-lg shadow-xl active:scale-95 transition-all">
            <i class="fas fa-print mr-2"></i>ç”Ÿæˆä¸¦å„²å­˜ PDF
        </button>
    </div>

    <div class="main-content">
        <div class="a4-preview" id="print-area">
            <div class="flex justify-between items-start mb-10">
                <div>
                    <h1 class="text-4xl font-black text-slate-900 tracking-tight mb-2">éŒ¦å¾·é˜²æ°´å·¥ç¨‹å ±åƒ¹å–®</h1>
                    <div class="h-1.5 w-24 bg-teal-600"></div>
                </div>
                <div class="text-right text-sm font-medium">
                    <p class="text-slate-400">å–®è™Ÿï¼š<span id="quoteId" class="text-slate-900 font-mono"></span></p>
                    <p class="text-slate-400">æ—¥æœŸï¼š<span id="currentDate" class="text-slate-900"></span></p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 pb-8 border-b">
                <div class="space-y-4">
                    <div class="flex items-center gap-4"><span class="text-slate-400 text-sm w-20 shrink-0">å®¢æˆ¶åç¨±</span><span id="out_name" class="border-b border-slate-200 w-full font-bold py-1">æœªå¡«å¯«</span></div>
                    <div class="flex items-center gap-4"><span class="text-slate-400 text-sm w-20 shrink-0">æ–½å·¥åœ°å€</span><span id="out_addr" class="border-b border-slate-200 w-full py-1 text-sm">æœªå¡«å¯«æ–½å·¥åœ°å€</span></div>
                    <div class="flex items-center gap-4"><span class="text-slate-400 text-sm w-20 shrink-0">è¯çµ¡é›»è©±</span><span id="out_phone" class="border-b border-slate-200 w-full py-1 font-mono"></span></div>
                </div>
            </div>

            <table class="w-full mb-6 border-t-2 border-slate-900">
                <thead>
                    <tr class="text-[11px] font-bold text-slate-400 uppercase border-b bg-slate-50">
                        <th class="py-3 text-left pl-4 w-1/3">å·¥ç¨‹é …ç›® / å·¥æ³•ç´°ç¯€</th>
                        <th class="py-3 text-left px-4">è¦æ ¼ææ–™</th>
                        <th class="py-3 text-center w-16">å–®ä½</th>
                        <th class="py-3 text-center w-24">å–®åƒ¹</th>
                        <th class="py-3 text-center w-16">æ•¸é‡</th>
                        <th class="py-3 text-right pr-4 w-28">å°è¨ˆ</th>
                        <th class="no-print w-10"></th>
                    </tr>
                </thead>
                <tbody id="itemTable"></tbody>
            </table>

            <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-10"></div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                <div class="md:col-span-3 space-y-4">
                    <h4 class="font-bold text-slate-900 border-l-4 border-teal-600 pl-2 text-sm font-black">å·¥ç¨‹ä¿å›ºèˆ‡æ”¯ä»˜æ¢æ¬¾</h4>
                    <ul class="text-[11px] text-slate-500 space-y-1 list-disc pl-4 italic font-bold">
                        <li>æœ¬å ±åƒ¹å–®æœ‰æ•ˆæœŸé™ç‚º 30 å¤©ã€‚</li>
                        <li>è‡ªå®Œå·¥æ—¥èµ·ï¼Œé‡å°æ–½å·¥å€åŸŸæä¾›é˜²æ°´ä¿å›ºè²³å¹´ã€‚</li>
                        <li>ä»˜æ¬¾æ–¹å¼ï¼šè¨‚é‡‘ 30%ã€ææ–™é€²å ´ 30%ã€é©—æ”¶å®Œæˆ 40%ã€‚</li>
                    </ul>
                </div>
                <div class="md:col-span-2 bg-slate-900 p-6 rounded-lg text-white">
                    <div class="flex justify-between text-xs text-slate-400 mb-2"><span>é …ç›®å°è¨ˆ</span><span id="sumBase" class="font-mono">0</span></div>
                    <div class="flex justify-between text-xs text-slate-400 mb-4 pb-4 border-b border-slate-700">
                        <label class="flex items-center gap-2 cursor-pointer no-print"><input type="checkbox" id="taxCheck" checked onchange="doCalc()"> ç‡Ÿæ¥­ç¨… (5%)</label>
                        <span id="sumTax" class="font-mono">0</span>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-teal-400 font-bold uppercase mb-1 tracking-widest">Total Amount</p>
                        <p class="text-3xl font-black font-mono">NT$ <span id="sumFinal">0</span></p>
                        <p class="text-[10px] text-slate-500 mt-4 border-t border-slate-800 pt-2 font-bold">ä¸­æ–‡å¤§å¯«ï¼š<span id="chineseAmt" class="text-white">é›¶å…ƒæ•´</span></p>
                    </div>
                </div>
            </div>

            <div class="mt-20 grid grid-cols-2 gap-12">
                <div class="border-t border-slate-900 pt-4">
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest mb-12">Authorized Signature</p>
                    <p class="text-sm font-black">éŒ¦å¾·é˜²æ°´å·¥ç¨‹è¡Œ ç°½ç« </p>
                </div>
                <div class="border-t border-slate-900 pt-4">
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest mb-12">Customer Signature</p>
                    <p class="text-sm font-bold text-slate-300 italic">å®¢æˆ¶ç¢ºèªç°½å</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®Œå…¨ä¿ç•™æ‚¨çš„ç¯„æœ¬å…§å®¹
        const TEMPLATES = {
            roof: [
                { name: "é ‚æ¨“ç´ åœ°æ•´ç†", spec: "å«é«˜å£“æ¸…æ´—/èˆŠæ–™æ¸…é™¤", unit: "åª", price: 800 },
                { name: "å¥³å…’ç‰†/è§’éš…è£œå¼·", spec: "å«ä¸ç¹”å¸ƒæŠ—è£‚å¸¶æ–½ä½œ", unit: "å¼", price: 3500 },
                { name: "é˜²æ°´åº•æ¼†æ»²é€å±¤", spec: "å¼·åŠ›æ»²é€å‹åº•æ¼†", unit: "åª", price: 500 },
                { name: "å½ˆæ€§æ°´æ³¥é˜²æ°´å±¤(äºŒå¡—)", spec: "è¤‡åˆå¼é«˜åˆ†å­ææ–™", unit: "åª", price: 1500 },
                { name: "æ–·ç†±è€å€™é¢æ¼†", spec: "éš”ç†±åå°„å°ˆç”¨é¢è† ", unit: "åª", price: 1000 }
            ],
            bathroom: [
                { name: "æµ´å®¤ç‰†é¢åœ°åªé˜²æ°´", spec: "å½ˆæ€§æ°´æ³¥ä¸‰å¡—æ–½ä½œ", unit: "é–“", price: 12000 },
                { name: "è½æ°´å­”æ­¢æ°´åŠ å¼·", spec: "å°ˆç”¨é˜²æ°´å¢Šç‰‡", unit: "è™•", price: 800 }
            ],
            crack: [
                { name: "é«˜å£“çŒæ³¨æ­¢æ¼å·¥ç¨‹", spec: "å–®æ¶²å‹ç™¼æ³¡æ¨¹è„‚", unit: "é‡", price: 600 }
            ]
        };

        window.onload = () => {
            const now = new Date();
            document.getElementById('currentDate').innerText = now.toLocaleDateString('zh-TW');
            document.getElementById('quoteId').innerText = `JD-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${Math.floor(Math.random()*900)+100}`;
            addNewRow();
        };

        function sync() {
            document.getElementById('out_name').innerText = document.getElementById('in_name').value || "æœªå¡«å¯«";
            document.getElementById('out_addr').innerText = document.getElementById('in_addr').value || "æœªå¡«å¯«æ–½å·¥åœ°å€";
            document.getElementById('out_phone').innerText = document.getElementById('in_phone').value || "";
        }

        function addNewRow(name="", spec="", unit="åª", price=0) {
            const tbody = document.getElementById('itemTable');
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-50";
            tr.innerHTML = `
                <td class="py-4 pl-4"><input type="text" class="w-full font-bold bg-transparent outline-none" value="${name}"></td>
                <td class="py-4 px-4"><input type="text" class="w-full text-slate-500 text-xs bg-transparent outline-none" value="${spec}"></td>
                <td class="py-4"><input type="text" class="w-full text-center text-xs bg-transparent outline-none" value="${unit}"></td>
                <td class="py-4"><input type="number" class="priceInput w-full text-right font-mono font-bold text-teal-600 bg-transparent outline-none" value="${price}" oninput="doCalc()"></td>
                <td class="py-4"><input type="number" class="qtyInput w-full text-center font-mono font-bold bg-transparent outline-none" value="1" oninput="doCalc()"></td>
                <td class="py-4 text-right pr-4 font-black font-mono subtotal text-slate-900">0</td>
                <td class="no-print text-center"><button onclick="this.parentElement.parentElement.remove();doCalc()" class="text-slate-200 hover:text-red-500"><i class="fas fa-times-circle"></i></button></td>
            `;
            tbody.appendChild(tr);
            doCalc();
        }

        function addFromTemplate(type) {
            TEMPLATES[type].forEach(i => addNewRow(i.name, i.spec, i.unit, i.price));
        }

        function doCalc() {
            let total = 0;
            document.querySelectorAll('#itemTable tr').forEach(row => {
                const p = parseFloat(row.querySelector('.priceInput').value) || 0;
                const q = parseFloat(row.querySelector('.qtyInput').value) || 0;
                const sub = p * q;
                row.querySelector('.subtotal').innerText = Math.round(sub).toLocaleString();
                total += sub;
            });
            const tax = document.getElementById('taxCheck').checked ? Math.round(total * 0.05) : 0;
            document.getElementById('sumBase').innerText = total.toLocaleString();
            document.getElementById('sumTax').innerText = tax.toLocaleString();
            document.getElementById('sumFinal').innerText = (total + tax).toLocaleString();
            document.getElementById('chineseAmt').innerText = numberToChinese(total + tax);
        }

        function applyArea() {
            const l = document.getElementById('calc_l').value || 0;
            const w = document.getElementById('calc_w').value || 0;
            const res = (l * w * 0.3025).toFixed(2);
            document.getElementById('res_area').innerText = res;
        }

        function handlePhotos(input) {
            const grid = document.getElementById('photoGrid');
            Array.from(input.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = "photo-card group";
                    div.innerHTML = `<img src="${e.target.result}"><button onclick="this.parentElement.remove()" class="no-print absolute top-1 right-1 bg-red-500 text-white w-5 h-5 rounded-full text-[10px]">âœ•</button>`;
                    grid.appendChild(div);
                }
                reader.readAsDataURL(file);
            });
        }

        function numberToChinese(n) {
            if (n === 0) return "é›¶å…ƒæ•´";
            const digit = ['é›¶', 'å£¹', 'è²³', 'åƒ', 'è‚†', 'ä¼', 'é™¸', 'æŸ’', 'æŒ', 'ç–'];
            const unit = [['å…ƒ', 'è¬', 'å„„'], ['', 'æ‹¾', 'ä½°', 'ä»Ÿ']];
            let s = 'æ•´'; n = Math.floor(n);
            for (let i = 0; i < unit[0].length && n > 0; i++) {
                let p = '';
                for (let j = 0; j < unit[1].length && n > 0; j++) {
                    p = digit[n % 10] + unit[1][j] + p;
                    n = Math.floor(n / 10);
                }
                s = p.replace(/(é›¶.)*é›¶$/, '').replace(/^$/, 'é›¶') + unit[0][i] + s;
            }
            return s.replace(/(é›¶.)*é›¶å…ƒ/, 'å…ƒ').replace(/(é›¶.)+/g, 'é›¶');
        }

        function saveAndPrint() {
            const cname = document.getElementById('in_name').value || "æœªå‘½å";
            document.title = `éŒ¦å¾·å ±åƒ¹_${cname}`;
            window.print();
        }
    </script>
</body>
</html>

