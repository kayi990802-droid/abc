<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JINDE | éŒ¦å¾·é›²ç«¯å ±åƒ¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0f172a; margin: 0; padding-bottom: 70px; }
        
        /* éš±è—æ²è»¸ */
        ::-webkit-scrollbar { display: none; }

        /* åˆ†é æ§åˆ¶ */
        .page { display: none; width: 100%; min-height: 100vh; }
        .page.active { display: block; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #1e293b; display: flex; justify-content: space-around;
            padding: 12px; border-top: 1px solid #334155; z-index: 100;
        }
        .nav-item { color: #94a3b8; text-align: center; font-size: 10px; font-weight: bold; }
        .nav-item.active { color: #2dd4bf; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

        /* æ‰‹æ©Ÿè¼¸å…¥å„ªåŒ– */
        input, textarea, select { font-size: 16px !important; background: #1e293b; border: 1px solid #334155; color: white; border-radius: 12px; padding: 12px; width: 100%; outline: none; }
        input:focus { border-color: #2dd4bf; }
        .label-title { font-size: 12px; color: #94a3b8; font-weight: 800; margin: 15px 0 5px 5px; display: block; }

        /* A4 é è¦½ç¸®æ”¾ (æ‰‹æ©Ÿå°ˆç”¨) */
        .preview-container { background: #334155; padding: 15px; display: flex; justify-content: center; }
        .a4-sheet { 
            width: 210mm; min-height: 297mm; background: white; color: #1e293b; 
            padding: 15mm; transform-origin: top center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        /* è‡ªå‹•é©æ‡‰å¯¬åº¦ */
        @media (max-width: 768px) {
            .a4-sheet { transform: scale(0.45); margin-bottom: -160mm; }
        }

        @media print {
            .bottom-nav, .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .page { display: none !important; }
            #page-preview { display: block !important; padding: 0; background: white; }
            .a4-sheet { transform: scale(1) !important; margin: 0 !important; box-shadow: none; }
        }
    </style>
</head>
<body>

    <div id="page-edit" class="page active p-5">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-black text-white">å·¥ç¨‹å ±åƒ¹ <span class="text-teal-400">ç·¨è¼¯</span></h2>
            <div class="bg-rose-500/20 text-rose-400 px-3 py-1 rounded-full text-xs font-mono">JD-0421605</div>
        </div>

        <section class="space-y-4">
            <div>
                <span class="label-title">åŸºæœ¬è³‡æ–™</span>
                <input type="text" id="in_name" placeholder="å®¢æˆ¶å§“å" oninput="sync()">
                <div class="mt-2"></div>
                <input type="text" id="in_addr" placeholder="æ–½å·¥åœ°å€" oninput="sync()">
            </div>

            <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                <span class="label-title mt-0 text-teal-400">å¿«é€Ÿåªæ•¸è©¦ç®—</span>
                <div class="flex gap-2">
                    <input type="number" id="calc_l" placeholder="é•·(m)" class="text-center">
                    <input type="number" id="calc_w" placeholder="å¯¬(m)" class="text-center">
                    <button onclick="calcPing()" class="bg-teal-600 px-6 rounded-xl font-black">è©¦ç®—</button>
                </div>
                <p class="text-right text-xs mt-2 text-slate-400">æ›ç®—çµæœï¼š<span id="res_ping" class="text-white">0</span> åª</p>
            </div>

            <div>
                <span class="label-title">å·¥æ³•ç¯„æœ¬è¿½åŠ </span>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="addTpl('roof')" class="bg-slate-700 p-4 rounded-xl text-sm font-bold border-l-4 border-teal-500 text-left">ğŸ—ï¸ é ‚æ¨“ä¸‰å¡—</button>
                    <button onclick="addTpl('crack')" class="bg-slate-700 p-4 rounded-xl text-sm font-bold border-l-4 border-blue-500 text-left">ğŸ’‰ é«˜å£“çŒæ³¨</button>
                </div>
            </div>

            <button onclick="switchPage('preview')" class="w-full bg-teal-500 py-4 rounded-2xl font-black text-lg shadow-lg shadow-teal-900/40 mt-6">
                æŸ¥çœ‹é è¦½å ±åƒ¹å–®
            </button>
        </section>
    </div>

    <div id="page-preview" class="page">
        <div class="no-print p-4 flex justify-between items-center bg-slate-800">
            <button onclick="switchPage('edit')" class="text-slate-400"><i class="fas fa-edit mr-2"></i>å›ç·¨è¼¯</button>
            <button onclick="window.print()" class="bg-teal-500 px-4 py-2 rounded-lg font-bold text-sm">ç¢ºèªåˆ—å° / PDF</button>
        </div>

        <div class="preview-container">
            <div class="a4-sheet" id="pdf-content">
                <div class="flex justify-between items-end border-b-4 border-slate-900 pb-4 mb-8">
                    <h1 class="text-3xl font-black">éŒ¦å¾·é˜²æ°´å·¥ç¨‹å ±åƒ¹å–®</h1>
                    <div class="text-right text-xs font-bold text-slate-400">
                        <p>å–®è™Ÿï¼šJD-0421605</p>
                        <p>æ—¥æœŸï¼š2026-01-27</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-10 mb-8">
                    <div class="border-l-4 border-teal-600 pl-4 font-black">
                        <p class="text-[10px] text-slate-400 uppercase">å®¢æˆ¶åç¨±</p>
                        <p id="out_name" class="text-xl">æœªå¡«å¯«</p>
                    </div>
                    <div class="border-l-4 border-slate-200 pl-4">
                        <p class="text-[10px] text-slate-400 uppercase">æ–½å·¥åœ°å€</p>
                        <p id="out_addr" class="text-xs text-slate-600 font-bold">æœªå¡«å¯«åœ°å€</p>
                    </div>
                </div>

                <table class="w-full mb-8">
                    <thead>
                        <tr class="bg-slate-100 text-[11px] font-black border-y-2 border-slate-900">
                            <th class="py-2 pl-2 text-left">æ–½å·¥é …ç›®</th>
                            <th class="py-2 text-center w-20">æ•¸é‡</th>
                            <th class="py-2 text-center w-20">å–®ä½</th>
                            <th class="py-2 text-right w-24">å–®åƒ¹</th>
                            <th class="py-2 pr-2 text-right w-32">å°è¨ˆ</th>
                        </tr>
                    </thead>
                    <tbody id="out_tbody"></tbody>
                </table>

                <div class="grid grid-cols-2 gap-10 mt-10">
                    <div class="text-[10px] text-slate-500 italic">
                        <p class="font-black text-slate-900 not-italic mb-2">å‚™è¨»äº‹é …ï¼š</p>
                        1. é˜²æ°´ä¿å›ºæœŸï¼šè²³å¹´ã€‚<br>
                        2. è¨‚é‡‘30%ã€å®Œå·¥æ”¯ä»˜70%ã€‚<br>
                        3. å«å·¥æ–™ã€æ¸…é‹ã€‚
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl text-right">
                        <p class="text-[10px] font-black text-teal-600 mb-1">TOTAL AMOUNT</p>
                        <p class="text-3xl font-black font-mono">NT$ <span id="sum_final">0</span></p>
                    </div>
                </div>

                <div class="mt-20 grid grid-cols-2 gap-20 text-center">
                    <div class="border-t border-slate-300 pt-4 font-black">éŒ¦å¾·é˜²æ°´å·¥ç¨‹ (ç°½ç« )</div>
                    <div class="border-t border-slate-300 pt-4 font-black text-slate-300">å®¢æˆ¶ç¢ºèªç°½å</div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav no-print">
        <div class="nav-item active" onclick="switchPage('edit')" id="nav-edit">
            <i class="fas fa-pen-to-square"></i>
            è³‡æ–™è¼¸å…¥
        </div>
        <div class="nav-item" onclick="switchPage('preview')" id="nav-preview">
            <i class="fas fa-file-invoice-dollar"></i>
            å ±åƒ¹å–®é è¦½
        </div>
        <div class="nav-item" onclick="location.href='index.html'">
            <i class="fas fa-home"></i>
            å›é¦–é 
        </div>
    </div>

    <script>
        // åˆ‡æ›é é¢é‚è¼¯
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('page-' + pageId).classList.add('active');
            document.getElementById('nav-' + pageId).classList.add('active');
            window.scrollTo(0,0);
        }

        // è³‡æ–™åŒæ­¥
        function sync() {
            document.getElementById('out_name').innerText = document.getElementById('in_name').value || "æœªå¡«å¯«";
            document.getElementById('out_addr').innerText = document.getElementById('in_addr').value || "æœªå¡«å¯«åœ°å€";
            calculate();
        }

        function addEmptyRow(name="", qty=1, unit="åª", price=0) {
            const tbody = document.getElementById('out_tbody');
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-100 text-sm font-bold";
            tr.innerHTML = `
                <td class="py-4 pl-2"><input type="text" value="${name}" class="bg-transparent text-slate-900 w-full border-none p-0 font-bold" oninput="calculate()"></td>
                <td class="py-4 text-center"><input type="number" value="${qty}" class="qty bg-transparent text-center w-full border-none p-0" oninput="calculate()"></td>
                <td class="py-4 text-center">${unit}</td>
                <td class="py-4 text-right"><input type="number" value="${price}" class="price bg-transparent text-right w-full border-none p-0 font-mono" oninput="calculate()"></td>
                <td class="py-4 pr-2 text-right font-black font-mono subtotal">0</td>
            `;
            tbody.appendChild(tr);
            calculate();
        }

        function calculate() {
            let total = 0;
            document.querySelectorAll('#out_tbody tr').forEach(row => {
                const q = parseFloat(row.querySelector('.qty').value) || 0;
                const p = parseFloat(row.querySelector('.priceInput')?.value || row.querySelector('.price').value) || 0;
                const sub = q * p;
                row.querySelector('.subtotal').innerText = Math.round(sub).toLocaleString();
                total += sub;
            });
            document.getElementById('sum_final').innerText = Math.round(total).toLocaleString();
        }

        function calcPing() {
            const l = document.getElementById('calc_l').value || 0;
            const w = document.getElementById('calc_w').value || 0;
            const res = (l * w * 0.3025).toFixed(2);
            document.getElementById('res_ping').innerText = res;
        }

        function addTpl(type) {
            if(type === 'roof') {
                addEmptyRow("å±‹é ‚ä¸‰å¡—åŠ å¼·é˜²æ°´", 20, "åª", 3500);
            } else {
                addEmptyRow("é«˜å£“çŒæ³¨æ­¢æ¼ (é‡)", 10, "é‡", 600);
            }
            switchPage('preview');
        }

        window.onload = () => { addEmptyRow(); };
    </script>
</body>
</html>
