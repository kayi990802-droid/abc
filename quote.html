<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>JINDE | 錦德全平台報價系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        :root { --accent: #2dd4bf; --bg-sidebar: #0f172a; }
        
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background: #1e293b; color: #f8fafc; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- 佈局核心 --- */
        @media (min-width: 1024px) {
            body { flex-direction: row; overflow: hidden; }
            .sidebar { width: 420px; height: 100vh; overflow-y: auto; background: var(--bg-sidebar); border-right: 1px solid rgba(255,255,255,0.05); flex-shrink: 0; }
            .main-preview { flex: 1; height: 100vh; overflow-y: auto; padding: 50px; background: #334155; }
        }

        @media (max-width: 1023px) {
            .sidebar { width: 100%; padding: 20px; background: var(--bg-sidebar); border-bottom: 2px solid var(--accent); }
            .main-preview { width: 100%; padding: 15px 0; background: #334155; }
            /* 手機版 A4 縮放：根據螢幕寬度自動計算縮放比 */
            .a4-container { 
                transform: scale(calc(100vw / 230mm)); 
                transform-origin: top center; 
                margin-bottom: calc(-297mm * (1 - (100vw / 230mm)) + 20px);
            }
        }

        /* --- A4 紙張樣式 --- */
        .a4-container {
            width: 210mm; min-height: 297mm; background: white; color: #1e293b;
            padding: 20mm; margin: 0 auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- 輸入框優化 (防止 iOS 自動放大) --- */
        input, textarea { 
            font-size: 16px !important; background: rgba(30, 41, 59, 0.7) !important; 
            border: 1px solid rgba(255,255,255,0.1) !important; color: white !important;
            border-radius: 12px; padding: 12px; transition: 0.2s;
        }
        input:focus { border-color: var(--accent) !important; outline: none; box-shadow: 0 0 0 2px rgba(45, 212, 191, 0.2); }

        .btn-touch { transition: all 0.2s; -webkit-tap-highlight-color: transparent; }
        .btn-touch:active { transform: scale(0.96); opacity: 0.8; }

        /* 列印設定 */
        @media print {
            .no-print { display: none !important; }
            body { background: white; display: block; }
            .main-preview { padding: 0; background: white; }
            .a4-container { transform: scale(1) !important; margin: 0 !important; box-shadow: none; border: none; }
        }
    </style>
</head>
<body>

    <aside class="sidebar no-print p-6 space-y-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black italic tracking-tighter">JINDE<span class="text-teal-400">.</span></h1>
                <p class="text-[9px] font-bold text-slate-500 tracking-widest">SMART QUOTE PRO</p>
            </div>
            <button onclick="location.href='toolbox.html'" class="bg-slate-800 text-teal-400 px-4 py-2 rounded-xl text-xs font-black border border-teal-500/20 btn-touch">
                <i class="fas fa-toolbox"></i>
            </button>
        </div>

        <div class="bg-slate-800/50 rounded-3xl p-5 border border-white/5 space-y-4 shadow-xl">
            <div class="flex justify-between items-center">
                <span class="text-[10px] font-black text-teal-400 uppercase tracking-wider">坪數累加工具</span>
                <button onclick="clearCalc()" class="text-[10px] text-slate-500 hover:text-rose-400">清空</button>
            </div>
            <div class="flex gap-2">
                <input type="number" id="l" placeholder="長" class="w-full text-center" inputmode="decimal">
                <input type="number" id="w" placeholder="寬" class="w-full text-center" inputmode="decimal">
                <button onclick="addArea()" class="bg-teal-500 text-slate-900 px-4 rounded-xl font-black btn-touch">+</button>
            </div>
            <div id="area_list" class="space-y-2 max-h-24 overflow-y-auto text-xs pr-1"></div>
            <div class="pt-4 border-t border-white/5 flex justify-between items-end">
                <div>
                    <p class="text-[9px] text-slate-500 font-bold">總計坪數</p>
                    <p class="text-2xl font-black"><span id="total_area_val">0.00</span> <span class="text-xs">坪</span></p>
                </div>
                <button onclick="applyToQuo()" class="bg-white text-slate-900 px-4 py-2 rounded-xl text-[10px] font-black btn-touch">填入報價</button>
            </div>
        </div>

        <div class="space-y-4">
            <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest">案場資訊</label>
            <input type="text" id="in_name" placeholder="客戶姓名 / 抬頭" class="w-full" oninput="sync()">
            <input type="text" id="in_addr" placeholder="施工地址" class="w-full" oninput="sync()">
            <div class="grid grid-cols-2 gap-2">
                <button onclick="addTemplate('roof')" class="bg-slate-800 p-3 rounded-xl text-[11px] font-bold border border-white/5 text-teal-400 btn-touch">頂樓三塗</button>
                <button onclick="addTemplate('crack')" class="bg-slate-800 p-3 rounded-xl text-[11px] font-bold border border-white/5 text-blue-400 btn-touch">高壓灌注</button>
            </div>
            <textarea id="in_terms" rows="3" class="w-full text-xs" oninput="sync()">1. 防水保固：貳年。&#10;2. 訂金30%、完工驗收70%。</textarea>
        </div>

        <button onclick="window.print()" class="w-full bg-teal-500 py-4 rounded-2xl text-slate-900 font-black text-lg shadow-lg btn-touch">
            <i class="fas fa-file-pdf mr-2"></i>生成 PDF 報價單
        </button>
    </aside>

    <main class="main-preview">
        <div class="a4-container" id="print-area">
            <div class="flex justify-between items-end border-b-4 border-slate-900 pb-6 mb-10">
                <div>
                    <h2 class="text-4xl font-black tracking-tighter italic">QUOTATION</h2>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">錦德防水工程行 JINDE WATERPROOFING</p>
                </div>
                <div class="text-right font-mono text-xs">
                    <p class="text-slate-300">NO.</p><p id="out_id" class="font-bold mb-1"></p>
                    <p class="text-slate-300">DATE.</p><p id="out_date" class="font-bold"></p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6 mb-10">
                <div class="p-5 bg-slate-50 rounded-2xl border-l-8 border-teal-500">
                    <p class="text-[9px] font-black text-slate-400 uppercase mb-2 tracking-widest">Customer</p>
                    <p class="text-xl font-black text-slate-800" id="out_name">未填寫客戶</p>
                </div>
                <div class="p-5 bg-slate-50 rounded-2xl border-l-8 border-slate-200">
                    <p class="text-[9px] font-black text-slate-400 uppercase mb-2 tracking-widest">Site Address</p>
                    <p class="text-xs font-bold text-slate-800" id="out_addr">未填寫地址</p>
                </div>
            </div>

            <table class="w-full mb-10">
                <thead class="bg-slate-900 text-white text-[10px] uppercase font-black tracking-widest">
                    <tr>
                        <th class="py-4 pl-4 text-left rounded-l-xl">項目名稱 / 工法細節</th>
                        <th class="py-4 text-center w-24">數量</th>
                        <th class="py-4 text-center w-20">單位</th>
                        <th class="py-4 pr-4 text-right rounded-r-xl w-32">金額 (TWD)</th>
                    </tr>
                </thead>
                <tbody id="item_tbody" class="text-sm font-bold text-slate-700"></tbody>
            </table>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-12">
                <div class="pt-4 border-t border-slate-100">
                    <h4 class="text-[10px] font-black text-slate-400 uppercase mb-3">條款與備註</h4>
                    <pre id="out_terms" class="text-[11px] text-slate-500 whitespace-pre-wrap leading-relaxed font-sans"></pre>
                </div>
                <div class="bg-slate-900 rounded-3xl p-8 text-white text-right shadow-xl">
                    <p class="text-[10px] font-black text-teal-400 uppercase tracking-widest mb-4">Total Amount</p>
                    <span class="text-4xl font-black font-mono italic"><span class="text-lg mr-1">NT$</span><span id="sum_final">0</span></span>
                </div>
            </div>

            <div class="mt-20 grid grid-cols-2 gap-20 text-center">
                <div class="border-t-2 border-slate-900 pt-3">
                    <p class="text-[10px] font-black text-slate-400 uppercase mb-8">Authorized Seal</p>
                    <p class="font-black text-sm text-slate-800">錦德防水工程行 (簽章)</p>
                </div>
                <div class="border-t-2 border-slate-900 pt-3">
                    <p class="text-[10px] font-black text-slate-400 uppercase mb-8">Client Signature</p>
                    <p class="font-black text-sm text-slate-800">客戶簽名確認</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        let areaList = [];
        window.onload = () => {
            const today = new Date();
            document.getElementById('out_date').innerText = today.toLocaleDateString('zh-TW');
            document.getElementById('out_id').innerText = 'JD-' + Date.now().toString().slice(-6);
            addTemplate('empty');
            sync();
        };

        // 坪數累加邏輯
        function addArea() {
            const l = parseFloat(document.getElementById('l').value) || 0;
            const w = parseFloat(document.getElementById('w').value) || 0;
            if(l > 0 && w > 0) {
                const p = l * w * 0.3025;
                areaList.push({ l, w, p });
                updateAreaUI();
                document.getElementById('l').value = ""; document.getElementById('w').value = "";
                document.getElementById('l').focus();
            }
        }
        function updateAreaUI() {
            const container = document.getElementById('area_list');
            container.innerHTML = "";
            let total = 0;
            areaList.forEach(item => {
                total += item.p;
                container.innerHTML += `<div class="flex justify-between bg-white/5 p-2 rounded-lg border border-white/5 text-slate-400">
                    <span>${item.l}×${item.w}m</span><span>${item.p.toFixed(2)} 坪</span>
                </div>`;
            });
            document.getElementById('total_area_val').innerText = total.toFixed(2);
        }
        function clearCalc() { areaList = []; updateAreaUI(); }
        function applyToQuo() {
            const total = document.getElementById('total_area_val').innerText;
            const target = document.querySelector('#item_tbody tr:last-child .qty-in');
            if(target) { target.value = total; calculateTotal(); }
        }

        // 報價單邏輯
        function sync() {
            document.getElementById('out_name').innerText = document.getElementById('in_name').value || "未填寫客戶";
            document.getElementById('out_addr').innerText = document.getElementById('in_addr').value || "未填寫地址";
            document.getElementById('out_terms').innerText = document.getElementById('in_terms').value;
            calculateTotal();
        }
        function addItem(name="", qty=0, unit="坪", price=3500) {
            const tbody = document.getElementById('item_tbody');
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-50";
            tr.innerHTML = `
                <td class="py-5 pl-2"><input type="text" value="${name}" class="w-full !text-slate-800 !bg-transparent !p-0 font-bold" oninput="calculateTotal()"></td>
                <td class="py-5 text-center"><input type="number" value="${qty}" class="qty-in text-center w-full !text-slate-800 !bg-transparent !p-0 font-bold" oninput="calculateTotal()" inputmode="decimal"></td>
                <td class="py-5 text-center"><input type="text" value="${unit}" class="text-center w-full !text-slate-800 !bg-transparent !p-0"></td>
                <td class="py-5 pr-4 text-right font-mono subtotal text-teal-600">0</td>
                <input type="hidden" class="p-val" value="${price}">
            `;
            tbody.appendChild(tr);
            calculateTotal();
        }
        function calculateTotal() {
            let total = 0;
            document.querySelectorAll('#item_tbody tr').forEach(row => {
                const q = parseFloat(row.querySelector('.qty-in').value) || 0;
                const name = row.querySelector('input').value;
                let p = 3500;
                if(name.includes("灌注")) p = 600;
                if(name.includes("清運")) p = 1;
                const sub = q * p;
                row.querySelector('.subtotal').innerText = Math.round(sub).toLocaleString();
                total += sub;
            });
            document.getElementById('sum_final').innerText = Math.round(total).toLocaleString();
        }
        function addTemplate(type) {
            const tbody = document.getElementById('item_tbody');
            if(type !== 'empty') tbody.innerHTML = "";
            if(type === 'roof') { addItem("頂樓三塗防水工程", 0, "坪", 3500); addItem("素地清理廢料搬運", 1, "式", 5000); }
            else if(type === 'crack') { addItem("高壓灌注補漏 (單液)", 0, "針", 600); }
            else { addItem("", 0, "坪", 0); }
            sync();
        }
    </script>
</body>
</html>
