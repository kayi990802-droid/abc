<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>錦德工程-請款單(強制顯示單位版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #f1f5f9; padding: 20px; }
        .print-container { 
            width: 210mm; 
            min-height: 297mm; 
            margin: 0 auto; 
            background: white; 
            padding: 20mm; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        /* 強制顯示單位格的邊框 */
        .unit-box {
            border: 2px solid #3b82f6 !important; /* 強制藍色邊框 */
            border-radius: 4px;
            padding: 4px;
            text-align: center;
            width: 80px;
            font-weight: bold;
            color: #1e40af;
        }
        .photo-slot {
            border: 2px dashed #cbd5e1;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            cursor: pointer;
        }
        .photo-slot img { width: 100%; height: 100%; object-fit: cover; }
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .print-container { box-shadow: none; margin: 0; width: 210mm; }
            .unit-box { border: 1px solid #000 !important; } /* 列印時變細黑框 */
        }
    </style>
</head>
<body>

    <div class="print-container">
        <div style="display: flex; justify-content: space-between; border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">
            <div>
                <h1 style="font-size: 28px; font-weight: 900; italic">錦德防水工程請款單</h1>
                <p style="color: #2563eb; font-weight: bold;">JINDE Engineering Invoice</p>
            </div>
            <div style="text-align: right; font-size: 12px;">
                <p>日期：<span id="dateText"></span></p>
                <p>單號：<span id="snText"></span></p>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <input type="text" placeholder="在此輸入：業主名稱/客戶姓名" style="width: 100%; font-size: 20px; font-weight: bold; border-bottom: 1px solid #ccc; outline: none; margin-bottom: 10px;">
            <input type="text" placeholder="在此輸入：工程項目/案名" style="width: 100%; font-size: 14px; border-bottom: 1px solid #ccc; outline: none;">
        </div>

        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
            <thead>
                <tr style="background: #f8fafc; border-bottom: 2px solid #000;">
                    <th style="padding: 10px; text-align: left;">施工項目說明</th>
                    <th style="padding: 10px; text-align: center; color: #2563eb;">單位</th>
                    <th style="padding: 10px; text-align: center;">數量</th>
                    <th style="padding: 10px; text-align: right;">單價</th>
                    <th style="padding: 10px; text-align: right;">小計</th>
                    <th class="no-print"></th>
                </tr>
            </thead>
            <tbody id="mainTable">
                <tr>
                    <td style="padding: 10px;"><input type="text" value="專業防水施作" style="width: 100%; outline: none;"></td>
                    <td style="padding: 10px; text-align: center;">
                        <input type="text" value="式" class="unit-box">
                    </td>
                    <td style="padding: 10px; text-align: center;"><input type="number" value="1" class="qty" oninput="calc()" style="width: 60px; text-align: center;"></td>
                    <td style="padding: 10px; text-align: right;"><input type="number" value="0" class="price" oninput="calc()" style="width: 80px; text-align: right;"></td>
                    <td class="subtotal" style="padding: 10px; text-align: right; font-weight: bold;">0</td>
                    <td class="no-print"></td>
                </tr>
            </tbody>
        </table>

        <button onclick="addRow()" class="no-print" style="background: #2563eb; color: white; padding: 5px 15px; border-radius: 4px; cursor: pointer;">+ 增加一行項目</button>

        <div style="margin-top: 30px;">
            <p style="font-weight: bold; border-bottom: 1px solid #eee; margin-bottom: 10px;">施工紀錄照片</p>
            <div style="display: grid; grid-template-cols: 1fr 1fr 1fr; gap: 20px; display: flex;">
                <div style="flex: 1;">
                    <div class="photo-slot" onclick="document.getElementById('f1').click()">
                        <span class="no-print">點擊上傳</span>
                        <img id="img1" style="display:none">
                    </div>
                    <input type="file" id="f1" style="display:none" onchange="showImg(this, 'img1')">
                    <input type="text" value="施工前" style="width: 100%; text-align: center; margin-top: 5px; font-size: 12px; border: none;">
                </div>
                <div style="flex: 1;">
                    <div class="photo-slot" onclick="document.getElementById('f2').click()">
                        <span class="no-print">點擊上傳</span>
                        <img id="img2" style="display:none">
                    </div>
                    <input type="file" id="f2" style="display:none" onchange="showImg(this, 'img2')">
                    <input type="text" value="施工中" style="width: 100%; text-align: center; margin-top: 5px; font-size: 12px; border: none;">
                </div>
                <div style="flex: 1;">
                    <div class="photo-slot" onclick="document.getElementById('f3').click()">
                        <span class="no-print">點擊上傳</span>
                        <img id="img3" style="display:none">
                    </div>
                    <input type="file" id="f3" style="display:none" onchange="showImg(this, 'img3')">
                    <input type="text" value="完工後" style="width: 100%; text-align: center; margin-top: 5px; font-size: 12px; border: none;">
                </div>
            </div>
        </div>

        <div style="flex-grow: 1;"></div>

        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 40px;">
            <div style="width: 50%;">
                <p style="font-size: 10px; color: #999;">備註：</p>
                <textarea style="width: 100%; h-20; background: #f9f9f9; border: none; padding: 10px; font-size: 12px;" placeholder="輸入保固內容..."></textarea>
            </div>
            <div style="text-align: right;">
                <p style="font-size: 14px;">未稅合計：<span id="sumBase">0</span></p>
                <p style="font-size: 14px; color: #2563eb; font-weight: bold;">營業稅 (5%)：<span id="sumTax">0</span></p>
                <div style="background: #000; color: #fff; padding: 15px 30px; border-radius: 8px; margin-top: 10px;">
                    <p style="font-size: 10px; color: #3b82f6;">TOTAL AMOUNT</p>
                    <p style="font-size: 32px; font-weight: 900;">NT$ <span id="sumTotal">0</span></p>
                    <p id="sumChinese" style="font-size: 12px; color: #ccc;">零元整</p>
                </div>
            </div>
        </div>
        
        <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button onclick="window.print()" style="background: #000; color: white; padding: 10px 40px; border-radius: 50px; font-weight: bold; cursor: pointer;">列印請款單 (PDF)</button>
        </div>
    </div>

    <script>
        document.getElementById('dateText').innerText = new Date().toLocaleDateString();
        document.getElementById('snText').innerText = "JD-" + Math.floor(Math.random()*900000 + 100000);

        function addRow() {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="padding: 10px;"><input type="text" placeholder="項目" style="width: 100%; outline: none;"></td>
                <td style="padding: 10px; text-align: center;"><input type="text" value="坪" class="unit-box"></td>
                <td style="padding: 10px; text-align: center;"><input type="number" value="1" class="qty" oninput="calc()" style="width: 60px; text-align: center;"></td>
                <td style="padding: 10px; text-align: right;"><input type="number" value="0" class="price" oninput="calc()" style="width: 80px; text-align: right;"></td>
                <td class="subtotal" style="padding: 10px; text-align: right; font-weight: bold;">0</td>
                <td class="no-print"><button onclick="this.parentElement.parentElement.remove();calc()" style="color:red; margin-left:10px;">✕</button></td>
            `;
            document.getElementById('mainTable').appendChild(tr);
        }

        function showImg(input, targetId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById(targetId);
                    img.src = e.target.result;
                    img.style.display = 'block';
                    img.parentElement.querySelector('span').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function calc() {
            let base = 0;
            const rows = document.querySelectorAll('#mainTable tr');
            rows.forEach(row => {
                const q = row.querySelector('.qty').value || 0;
                const p = row.querySelector('.price').value || 0;
                const sub = q * p;
                row.querySelector('.subtotal').innerText = sub.toLocaleString();
                base += sub;
            });
            const tax = Math.round(base * 0.05);
            const total = base + tax;
            document.getElementById('sumBase').innerText = base.toLocaleString();
            document.getElementById('sumTax').innerText = tax.toLocaleString();
            document.getElementById('sumTotal').innerText = total.toLocaleString();
            document.getElementById('sumChinese').innerText = numberToChinese(total);
        }

        function numberToChinese(n) {
            if(!n) return "零元整";
            const fraction = ['角', '分'];
            const digit = ['零', '壹', '貳', '參', '肆', '伍', '陸', '柒', '捌', '玖'];
            const unit = [['元', '萬', '億'], ['', '拾', '佰', '仟']];
            let s = '';
            for (let i = 0; i < unit[0].length && n > 0; i++) {
                let p = '';
                for (let j = 0; j < unit[1].length && n > 0; j++) {
                    p = digit[n % 10] + (n % 10 !== 0 ? unit[1][j] : '') + p;
                    n = Math.floor(n / 10);
                }
                s = p.replace(/(零.)*零$/, '').replace(/^$/, '零') + unit[0][i] + s;
            }
            return s.replace(/(零.)*零元/, '元').replace(/(零.)+/g, '零').replace(/^元/, '零元') + '整';
        }
    </script>
</body>
</html>
